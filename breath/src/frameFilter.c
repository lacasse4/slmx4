#include "frameFilter.h"

static float filter_taps[FRAMEFILTER_TAP_NUM] = {
  0.0,
  0.0002897213242428921,
  0.00032241337564862724,
  0.00037737021278614084,
  0.00045419752980425894,
  0.0005521655717997306,
  0.0006736267822915079,
  0.000815534253926618,
  0.0009792102862142915,
  0.0011627038774103167,
  0.001367437631834154,
  0.0015930462159639742,
  0.0018396577202244922,
  0.002124041118057774,
  0.0023857915342217627,
  0.002689909131994041,
  0.0030107645972259948,
  0.00334904627733443,
  0.0037052678758400493,
  0.0040746504886027,
  0.0044614203854570125,
  0.00486245293564738,
  0.005277908110172496,
  0.0057058060140355235,
  0.006145055242347534,
  0.006594987623094357,
  0.00705112150540588,
  0.007525932910937809,
  0.008002245268524825,
  0.008485867781906358,
  0.008975066086237908,
  0.00946677132369162,
  0.009967584224200935,
  0.010466011292728937,
  0.010965726036350135,
  0.01146472735838304,
  0.011962399986543006,
  0.012457868903363213,
  0.012949011723534425,
  0.013436070744605203,
  0.013912290637852107,
  0.014383471865079281,
  0.014845031427726214,
  0.015296141346349407,
  0.0157399135518609,
  0.016154453603507386,
  0.016568467469903855,
  0.01696534218987607,
  0.01734545585909548,
  0.017707598304383416,
  0.018050098261532626,
  0.01837349360485806,
  0.01867560691350111,
  0.018958366057710424,
  0.01921691393118967,
  0.01945195961666346,
  0.019660390116494703,
  0.01981181578393427,
  0.020084697700001604,
  0.020194413106218816,
  0.02030283077670642,
  0.020390064647471985,
  0.020453222459616616,
  0.02049254925309162,
  0.020505106408194824,
  0.02049254925309162,
  0.020453222459616616,
  0.020390064647471985,
  0.02030283077670642,
  0.020194413106218816,
  0.020084697700001604,
  0.01981181578393427,
  0.019660390116494703,
  0.01945195961666346,
  0.01921691393118967,
  0.018958366057710424,
  0.01867560691350111,
  0.01837349360485806,
  0.018050098261532626,
  0.017707598304383416,
  0.01734545585909548,
  0.01696534218987607,
  0.016568467469903855,
  0.016154453603507386,
  0.0157399135518609,
  0.015296141346349407,
  0.014845031427726214,
  0.014383471865079281,
  0.013912290637852107,
  0.013436070744605203,
  0.012949011723534425,
  0.012457868903363213,
  0.011962399986543006,
  0.01146472735838304,
  0.010965726036350135,
  0.010466011292728937,
  0.009967584224200935,
  0.00946677132369162,
  0.008975066086237908,
  0.008485867781906358,
  0.008002245268524825,
  0.007525932910937809,
  0.00705112150540588,
  0.006594987623094357,
  0.006145055242347534,
  0.0057058060140355235,
  0.005277908110172496,
  0.00486245293564738,
  0.0044614203854570125,
  0.0040746504886027,
  0.0037052678758400493,
  0.00334904627733443,
  0.0030107645972259948,
  0.002689909131994041,
  0.0023857915342217627,
  0.002124041118057774,
  0.0018396577202244922,
  0.0015930462159639742,
  0.001367437631834154,
  0.0011627038774103167,
  0.0009792102862142915,
  0.000815534253926618,
  0.0006736267822915079,
  0.0005521655717997306,
  0.00045419752980425894,
  0.00037737021278614084,
  0.00032241337564862724,
  0.0002897213242428921,
  0.0
};

void frameFilter_init(frameFilter* f) {
  int i;
  for(i = 0; i < FRAMEFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void frameFilter_put(frameFilter* f, float input) {
  f->history[f->last_index++] = input;
  if(f->last_index == FRAMEFILTER_TAP_NUM)
    f->last_index = 0;
}

float frameFilter_get(frameFilter* f) {
  float acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < FRAMEFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : FRAMEFILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}
