#include "frameFilter.h"

static float filter_taps[FRAMEFILTER_TAP_NUM] = {
  -0.03416529416747024,
  -0.001044754238418005,
  -0.0007167769973433243,
  -0.0003184686019675306,
  0.00026894151649324886,
  0.0010541349865118858,
  0.002024911219449508,
  0.003169776201787809,
  0.004485271209994198,
  0.005970519475423415,
  0.007618572805454376,
  0.009414305393068773,
  0.011338968433718783,
  0.013374402802537828,
  0.015502510593061888,
  0.01770244927653744,
  0.01995004757119858,
  0.022219965448209717,
  0.02448748441743348,
  0.02672797280230364,
  0.02891549715818666,
  0.03102290371945177,
  0.0330234065788049,
  0.0348918387568744,
  0.036604567340052886,
  0.038139026837447,
  0.039474162480252026,
  0.04059164725931567,
  0.0414766775475688,
  0.042117770517398026,
  0.042506262271138344,
  0.04263644036564362,
  0.042506262271138344,
  0.042117770517398026,
  0.0414766775475688,
  0.04059164725931567,
  0.039474162480252026,
  0.038139026837447,
  0.036604567340052886,
  0.0348918387568744,
  0.0330234065788049,
  0.03102290371945177,
  0.02891549715818666,
  0.02672797280230364,
  0.02448748441743348,
  0.022219965448209717,
  0.01995004757119858,
  0.01770244927653744,
  0.015502510593061888,
  0.013374402802537828,
  0.011338968433718783,
  0.009414305393068773,
  0.007618572805454376,
  0.005970519475423415,
  0.004485271209994198,
  0.003169776201787809,
  0.002024911219449508,
  0.0010541349865118858,
  0.00026894151649324886,
  -0.0003184686019675306,
  -0.0007167769973433243,
  -0.001044754238418005,
  -0.03416529416747024
};

void frameFilter_init(frameFilter* f) {
  int i;
  for(i = 0; i < FRAMEFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void frameFilter_put(frameFilter* f, float input) {
  f->history[f->last_index++] = input;
  if(f->last_index == FRAMEFILTER_TAP_NUM)
    f->last_index = 0;
}

float frameFilter_get(frameFilter* f) {
  float acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < FRAMEFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : FRAMEFILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}
